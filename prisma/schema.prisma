// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================================================
// USERS & AUTHENTICATION
// ============================================================================
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  fullName  String?
  role      String   @default("admin") // admin, editor, viewer
  isActive  Boolean  @default(true)

  // Relations
  createdTreks     Trek[]
  createdBlogs     BlogPost[]
  contactResponses ContactSubmission[]
  uploadedMedia    MediaLibrary[]
  auditLogs        AuditLog[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

// ============================================================================
// GLOBAL SETTINGS
// ============================================================================
model Settings {
  id String @id @default(cuid())

  // Brand & Visual
  logoUrl       String?
  darkLogoUrl   String?
  faviconUrl    String?
  heroImageUrl  String?
  footerBannerUrl String?

  // Contact Info
  phoneNumbers    String[]
  emailAddresses  String[]
  whatsapp        String?
  viber           String?
  emergencyContact String?

  // Office Location
  officeAddress   String?
  mapEmbedLink    String?
  latitude        Decimal?
  longitude       Decimal?

  // Social Media
  facebookUrl  String?
  instagramUrl String?
  youtubeUrl   String?
  tiktokUrl    String?
  twitterUrl   String?
  linkedinUrl  String?

  // SEO Defaults
  defaultMetaTitle       String?
  defaultMetaDescription String?
  defaultKeywords        String[]
  defaultOgImage         String?

  // Footer
  footerText    String?
  copyrightText String?

  // Global Scripts
  googleAnalyticsCode String?
  tagManagerCode      String?
  facebookPixelCode   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("settings")
}

// ============================================================================
// TREK MANAGEMENT
// ============================================================================
model TrekCategory {
  id          String  @id @default(cuid())
  name        String  @unique
  slug        String  @unique
  description String?
  imageUrl    String?
  displayOrder Int    @default(0)
  isActive    Boolean @default(true)

  treks Trek[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("trek_categories")
}

model Trek {
  id       String  @id @default(cuid())
  name     String
  slug     String  @unique
  category TrekCategory? @relation(fields: [categoryId], references: [id])
  categoryId String?

  // Basic Info
  shortDescription String?
  description      String?

  // Trek Details
  duration    String?  // "14 Days"
  maxAltitude String?  // "5,364m"
  difficulty  String?  // Easy, Moderate, Challenging, Strenuous
  price       Decimal?

  // Seasons
  bestSeasons     String[]
  availableMonths Int[]

  // Ratings
  rating     Decimal @default(0)
  reviewCount Int    @default(0)

  // Media
  featuredImageUrl String?
  galleryImages    String[]

  // SEO
  metaTitle           String?
  metaDescription     String?
  seoKeywords         String[]
  longTailKeywords    String[]
  schemaData          Json?
  ogImageUrl          String?
  twitterImageUrl     String?

  // Content
  highlights String[]
  includes   String[]
  excludes   String[]

  // Status & Admin
  isFeatured Boolean @default(false)
  isPublished Boolean @default(true)
  createdBy  User?   @relation(fields: [createdById], references: [id])
  createdById String?

  // Relations
  itineraries Itinerary[]
  reviews     TrekReview[]
  bookings    Booking[]
  seoSuggestions SeoSuggestion[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([categoryId])
  @@index([isFeatured])
  @@map("treks")
}

model Itinerary {
  id        String  @id @default(cuid())
  trek      Trek    @relation(fields: [trekId], references: [id], onDelete: Cascade)
  trekId    String
  dayNumber Int
  title     String
  description String?
  altitude  String?
  distance  String?
  activities String[]
  displayOrder Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([trekId, dayNumber])
  @@map("trek_itineraries")
}

model TrekReview {
  id        String  @id @default(cuid())
  trek      Trek    @relation(fields: [trekId], references: [id], onDelete: Cascade)
  trekId    String
  authorName String
  authorEmail String?
  rating    Int
  reviewText String?
  helpfulCount Int @default(0)
  isFeatured Boolean @default(false)
  isApproved Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([trekId])
  @@map("trek_reviews")
}

// ============================================================================
// BLOG MANAGEMENT
// ============================================================================
model BlogCategory {
  id          String  @id @default(cuid())
  name        String  @unique
  slug        String  @unique
  description String?
  displayOrder Int    @default(0)

  posts BlogPost[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("blog_categories")
}

model BlogPost {
  id       String  @id @default(cuid())
  title    String
  slug     String  @unique
  excerpt  String?
  content  String?
  category BlogCategory? @relation(fields: [categoryId], references: [id])
  categoryId String?

  // Media
  featuredImageUrl String?

  // SEO
  metaTitle       String?
  metaDescription String?
  seoKeywords     String[]
  schemaData      Json?
  ogImageUrl      String?

  // Author & Status
  author      User?   @relation(fields: [authorId], references: [id])
  authorId    String?
  isFeatured  Boolean @default(false)
  isPublished Boolean @default(true)
  publishedAt DateTime?

  // Engagement
  viewCount Int @default(0)

  // Relations
  seoSuggestions SeoSuggestion[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([categoryId])
  @@index([isPublished])
  @@index([isFeatured])
  @@map("blog_posts")
}

// ============================================================================
// BOOKINGS
// ============================================================================
model Booking {
  id   String @id @default(cuid())
  trek Trek   @relation(fields: [trekId], references: [id])
  trekId String

  // Customer
  firstName String
  lastName  String
  email     String
  phone     String
  country   String?

  // Details
  travelersCount Int @default(1)
  departureDate DateTime
  dietaryRequirements String?
  specialRequests String?

  // Pricing
  totalPrice Decimal
  paidAmount Decimal @default(0)
  paymentStatus String @default("pending") // pending, partial, completed, cancelled
  paymentMethod String?

  // Status
  bookingStatus String @default("pending") // pending, confirmed, cancelled
  confirmationSentAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([trekId])
  @@index([email])
  @@index([bookingStatus])
  @@map("bookings")
}

// ============================================================================
// MEDIA LIBRARY
// ============================================================================
model MediaLibrary {
  id       String @id @default(cuid())
  fileName String
  fileUrl  String
  fileType String? // image, video, document
  mimeType String?
  fileSizeBytes BigInt?

  // Media Info
  width    Int?
  height   Int?
  altText  String?
  caption  String?

  // Organization
  category String? // logo, hero, gallery, blog, etc.
  tags     String[]

  // Usage
  uploadedBy User?   @relation(fields: [uploadedById], references: [id])
  uploadedById String?
  isPublic Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([category])
  @@index([uploadedById])
  @@map("media_library")
}

// ============================================================================
// CONTACT FORM
// ============================================================================
model ContactSubmission {
  id   String @id @default(cuid())
  fullName String
  email    String
  phone    String?
  subject  String?
  message  String

  // Response
  isRead    Boolean @default(false)
  responseText String?
  respondedAt DateTime?
  respondedBy User? @relation(fields: [respondedById], references: [id])
  respondedById String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
  @@index([createdAt])
  @@map("contact_submissions")
}

// ============================================================================
// SEO & AI SUGGESTIONS
// ============================================================================
model SeoSuggestion {
  id   String @id @default(cuid())
  contentType String // trek, blog
  contentId String

  trek Trek? @relation(fields: [trekId], references: [id], onDelete: SetNull)
  trekId String?

  blog BlogPost? @relation(fields: [blogId], references: [id], onDelete: SetNull)
  blogId String?

  // Original
  originalTitle String?
  originalContent String?

  // Suggestions
  suggestedTitle       String?
  suggestedDescription String?
  suggestedKeywords    String[]
  contentImprovements  String?
  missingSections      String[]
  internalLinkSuggestions String[]

  // Status
  isApplied Boolean @default(false)
  appliedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([contentType, contentId])
  @@map("seo_suggestions")
}

// ============================================================================
// AUDIT LOG
// ============================================================================
model AuditLog {
  id   String @id @default(cuid())
  user User?  @relation(fields: [userId], references: [id])
  userId String?

  action     String // CREATE, UPDATE, DELETE
  entityType String // trek, blog, booking, etc.
  entityId   String?
  oldValues  Json?
  newValues  Json?
  ipAddress  String?

  createdAt DateTime @default(now())

  @@index([userId])
  @@index([entityType, entityId])
  @@index([createdAt])
  @@map("audit_logs")
}
